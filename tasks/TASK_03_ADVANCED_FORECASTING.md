# üìö –ó–ê–î–ê–ù–ò–ï 3: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ Cash Flow

## üéØ –¶–µ–ª—å –∑–∞–¥–∞–Ω–∏—è

–í—ã —É–ª—É—á—à–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π AI-–∞–≥–µ–Ω—Ç –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è, –¥–æ–±–∞–≤–∏–≤:
1. **–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑** ‚Äî —Ç—Ä–µ–Ω–¥—ã, —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—å, –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
2. **–£–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã** ‚Äî –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ-–∑–∞–≤–∏—Å–∏–º—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è AI
3. **–û–±—ä—è—Å–Ω–µ–Ω–∏—è –ø—Ä–æ–≥–Ω–æ–∑–æ–≤** ‚Äî –ø–æ—á–µ–º—É AI –≤—ã–¥–∞–ª –∏–º–µ–Ω–Ω–æ —Ç–∞–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
4. **–ú–µ—Ç—Ä–∏–∫–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏** ‚Äî –Ω–∞—Å–∫–æ–ª—å–∫–æ AI —É–≤–µ—Ä–µ–Ω –≤ –ø—Ä–æ–≥–Ω–æ–∑–µ
5. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏** ‚Äî –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–π, –ø–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–Ω—ã–π, –±–∞–∑–æ–≤—ã–π

---

## üìñ –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å

### –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ—Å—Ç–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∞

–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ `ai_agents/forecast_agent.py` –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:

```python
# –¢–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥ (–ø—Ä–æ—Å—Ç–æ–π):
message = f"""
Category: {category}
Historical values: {values}
Based on this historical cash flow data, provide a numerical forecast.
"""
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå AI –Ω–µ –∑–Ω–∞–µ—Ç, –∫–∞–∫–æ–π —ç—Ç–æ —Ç–∏–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–¥–æ—Ö–æ–¥/—Ä–∞—Å—Ö–æ–¥)
- ‚ùå –ù–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –æ —Ç—Ä–µ–Ω–¥–∞—Ö –∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞—Ö
- ‚ùå –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- ‚ùå –ù–µ—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏—è, –ø–æ—á–µ–º—É –≤—ã–±—Ä–∞–Ω–æ –∏–º–µ–Ω–Ω–æ —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ
- ‚ùå –û–¥–∏–Ω –ø—Ä–æ–≥–Ω–æ–∑ –±–µ–∑ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### –†–µ—à–µ–Ω–∏–µ: –£–º–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–µ—Ä–µ–¥ –ø—Ä–æ–≥–Ω–æ–∑–æ–º

```python
# –ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥ (–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π):
1. –í—ã—á–∏—Å–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (—Ç—Ä–µ–Ω–¥, —Å—Ä–µ–¥–Ω–µ–µ, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ)
2. –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–¥–æ—Ö–æ–¥/—Ä–∞—Å—Ö–æ–¥)
3. –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
4. –ü—Ä–æ—Å–∏–º AI –¥–∞—Ç—å –ø—Ä–æ–≥–Ω–æ–∑ —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º
5. –ü–∞—Ä—Å–∏–º —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç (–∑–Ω–∞—á–µ–Ω–∏–µ + –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ)
```

---

## üõ† –í–∞—à–µ –∑–∞–¥–∞–Ω–∏–µ

–°–æ–∑–¥–∞–π—Ç–µ —É–ª—É—á—à–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –∞–≥–µ–Ω—Ç–∞ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è.

### –®–∞–≥ 1: –î–æ–±–∞–≤—å—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä

–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª `ai_agents/forecast_analyzer.py`:

```python
"""
–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–≥–Ω–æ–∑–æ–≤
"""
import pandas as pd
import numpy as np
from typing import Dict, List


def calculate_trend(values: List[float]) -> str:
    """
    –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç—Ä–µ–Ω–¥ –≤ –¥–∞–Ω–Ω—ã—Ö

    Args:
        values: –°–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π (–æ—Ç —Å—Ç–∞—Ä—ã—Ö –∫ –Ω–æ–≤—ã–º)

    Returns:
        –û–¥–Ω–æ –∏–∑: "—Å–∏–ª—å–Ω—ã–π —Ä–æ—Å—Ç", "—É–º–µ—Ä–µ–Ω–Ω—ã–π —Ä–æ—Å—Ç", "—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å",
                 "—É–º–µ—Ä–µ–Ω–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ", "—Å–∏–ª—å–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ"
    """
    if len(values) < 2:
        return "–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö"

    # TODO: –†–µ–∞–ª–∏–∑—É–π—Ç–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–∞
    # –ü–æ–¥—Å–∫–∞–∑–∫–∞ 1: –í—ã—á–∏—Å–ª–∏—Ç–µ —Å—Ä–µ–¥–Ω–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–µ–∂–¥—É –ø–µ—Ä–∏–æ–¥–∞–º–∏
    # changes = [(values[i] - values[i-1]) / abs(values[i-1]) * 100
    #            for i in range(1, len(values)) if values[i-1] != 0]

    # –ü–æ–¥—Å–∫–∞–∑–∫–∞ 2: –í—ã—á–∏—Å–ª–∏—Ç–µ —Å—Ä–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
    # avg_change = np.mean(changes) if changes else 0

    # –ü–æ–¥—Å–∫–∞–∑–∫–∞ 3: –ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–π—Ç–µ —Ç—Ä–µ–Ω–¥ –ø–æ –ø–æ—Ä–æ–≥–æ–≤—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º
    # if avg_change > 10:
    #     return "—Å–∏–ª—å–Ω—ã–π —Ä–æ—Å—Ç"
    # elif avg_change > 3:
    #     return "—É–º–µ—Ä–µ–Ω–Ω—ã–π —Ä–æ—Å—Ç"
    # ...

    pass  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –∫–æ–¥


def calculate_volatility(values: List[float]) -> str:
    """
    –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å) –¥–∞–Ω–Ω—ã—Ö

    Args:
        values: –°–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π

    Returns:
        –û–¥–Ω–æ –∏–∑: "–≤—ã—Å–æ–∫–∞—è", "—Å—Ä–µ–¥–Ω—è—è", "–Ω–∏–∑–∫–∞—è"
    """
    if len(values) < 2:
        return "–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö"

    # TODO: –†–µ–∞–ª–∏–∑—É–π—Ç–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
    # –ü–æ–¥—Å–∫–∞–∑–∫–∞ 1: –í—ã—á–∏—Å–ª–∏—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
    # std_dev = np.std(values)

    # –ü–æ–¥—Å–∫–∞–∑–∫–∞ 2: –í—ã—á–∏—Å–ª–∏—Ç–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–∞—Ä–∏–∞—Ü–∏–∏ (CV)
    # mean_val = np.mean(values)
    # cv = (std_dev / abs(mean_val) * 100) if mean_val != 0 else 0

    # –ü–æ–¥—Å–∫–∞–∑–∫–∞ 3: –ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–π—Ç–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
    # if cv > 20:
    #     return "–≤—ã—Å–æ–∫–∞—è"
    # elif cv > 10:
    #     return "—Å—Ä–µ–¥–Ω—è—è"
    # else:
    #     return "–Ω–∏–∑–∫–∞—è"

    pass  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –∫–æ–¥


def detect_category_type(category: str, values: List[float]) -> str:
    """
    –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–¥–æ—Ö–æ–¥ –∏–ª–∏ —Ä–∞—Å—Ö–æ–¥)

    Args:
        category: –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        values: –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è

    Returns:
        –û–¥–Ω–æ –∏–∑: "–¥–æ—Ö–æ–¥", "—Ä–∞—Å—Ö–æ–¥", "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"
    """
    # TODO: –†–µ–∞–ª–∏–∑—É–π—Ç–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

    # –ü–æ–¥—Å–∫–∞–∑–∫–∞ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏
    income_keywords = ['–ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è', '–¥–æ—Ö–æ–¥', '–≤—ã—Ä—É—á–∫–∞', 'revenue', 'income']
    expense_keywords = ['–ø–ª–∞—Ç–µ–∂', '—Ä–∞—Å—Ö–æ–¥', '–∑–∞—Ä–ø–ª–∞—Ç–∞', '–∞—Ä–µ–Ω–¥–∞', '–Ω–∞–ª–æ–≥',
                       'expense', 'payment', 'salary']

    # category_lower = category.lower()
    # if any(kw in category_lower for kw in income_keywords):
    #     return "–¥–æ—Ö–æ–¥"
    # elif any(kw in category_lower for kw in expense_keywords):
    #     return "—Ä–∞—Å—Ö–æ–¥"

    # –ü–æ–¥—Å–∫–∞–∑–∫–∞ 2: –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –ø–æ —Å–ª–æ–≤–∞–º, –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –ø–æ –∑–Ω–∞–∫—É –∑–Ω–∞—á–µ–Ω–∏–π
    # avg_value = np.mean(values)
    # if avg_value > 0:
    #     return "–¥–æ—Ö–æ–¥"
    # elif avg_value < 0:
    #     return "—Ä–∞—Å—Ö–æ–¥"

    # return "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"

    pass  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –∫–æ–¥


def analyze_historical_data(category: str, values: List[float]) -> Dict:
    """
    –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

    Args:
        category: –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        values: –°–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π

    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π:
        {
            'category': str,
            'category_type': str,
            'trend': str,
            'volatility': str,
            'mean': float,
            'std_dev': float,
            'min': float,
            'max': float,
            'last_value': float
        }
    """
    # TODO: –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
    # –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã—à–µ

    analysis = {
        'category': category,
        'category_type': detect_category_type(category, values),
        'trend': calculate_trend(values),
        'volatility': calculate_volatility(values),
        'mean': np.mean(values),
        'std_dev': np.std(values),
        'min': np.min(values),
        'max': np.max(values),
        'last_value': values[-1] if values else 0
    }

    return analysis
```

---

### –®–∞–≥ 2: –£–ª—É—á—à–∏—Ç–µ –ø—Ä–æ–º–ø—Ç —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

–û–±–Ω–æ–≤–∏—Ç–µ `ai_agents/forecast_agent.py`, –¥–æ–±–∞–≤–∏–≤ –º–µ—Ç–æ–¥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —É–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞:

```python
from ai_agents.forecast_analyzer import analyze_historical_data


class ForecastAgent:
    """
    –£–ª—É—á—à–µ–Ω–Ω—ã–π AI agent –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è
    """

    def _create_advanced_prompt(
        self,
        category: str,
        values: List[float],
        analysis: Dict
    ) -> str:
        """
        –°–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ-–∑–∞–≤–∏—Å–∏–º—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è AI

        Args:
            category: –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            values: –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
            analysis: –†–µ–∑—É–ª—å—Ç–∞—Ç analyze_historical_data()

        Returns:
            –ü—Ä–æ–º–ø—Ç –¥–ª—è AI-–∞–≥–µ–Ω—Ç–∞
        """
        # TODO: –°–æ–∑–¥–∞–π—Ç–µ —É–ª—É—á—à–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç

        prompt = f"""
–¢—ã ‚Äî —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π—Å—è –Ω–∞ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–∏ cash flow.

–ö–ê–¢–ï–ì–û–†–ò–Ø: {category}
–¢–ò–ü: {analysis['category_type']}

–ò–°–¢–û–†–ò–ß–ï–°–ö–ò–ï –î–ê–ù–ù–´–ï (–ø–æ—Å–ª–µ–¥–Ω–∏–µ {len(values)} –ø–µ—Ä–∏–æ–¥–æ–≤):
{values}

–°–¢–ê–¢–ò–°–¢–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó:
- –°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: {analysis['mean']:,.2f}
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ: {analysis['std_dev']:,.2f}
- –ú–∏–Ω–∏–º—É–º: {analysis['min']:,.2f}
- –ú–∞–∫—Å–∏–º—É–º: {analysis['max']:,.2f}
- –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: {analysis['last_value']:,.2f}
- –¢—Ä–µ–Ω–¥: {analysis['trend']}
- –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å: {analysis['volatility']}

–ó–ê–î–ê–ß–ê:
–°–ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–π –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –ø–µ—Ä–∏–æ–¥.

–ò–ù–°–¢–†–£–ö–¶–ò–ò:
1. –£—á—Ç–∏ –≤—ã—è–≤–ª–µ–Ω–Ω—ã–π —Ç—Ä–µ–Ω–¥ ({analysis['trend']})
2. –£—á—Ç–∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å ({analysis['volatility']})
3. –≠—Ç–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–∏–ø–∞ "{analysis['category_type']}" - —É—á—Ç–∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫—É
4. –ï—Å–ª–∏ —Ç—Ä–µ–Ω–¥ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π, –∏—Å–ø–æ–ª—å–∑—É–π —Å—Ä–µ–¥–Ω–µ–µ –∏–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
5. –ï—Å–ª–∏ —Ç—Ä–µ–Ω–¥ —Ä–∞—Å—Ç—É—â–∏–π/–ø–∞–¥–∞—é—â–∏–π, —ç–∫—Å—Ç—Ä–∞–ø–æ–ª–∏—Ä—É–π –µ–≥–æ

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–π—Å—è):
–ü–†–û–ì–ù–û–ó: [—á–∏—Å–ª–æ]
–£–í–ï–†–ï–ù–ù–û–°–¢–¨: [–≤—ã—Å–æ–∫–∞—è/—Å—Ä–µ–¥–Ω—è—è/–Ω–∏–∑–∫–∞—è]
–û–ë–û–°–ù–û–í–ê–ù–ò–ï: [–∫—Ä–∞—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –≤ 1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö]

–ü—Ä–∏–º–µ—Ä:
–ü–†–û–ì–ù–û–ó: 1500000.50
–£–í–ï–†–ï–ù–ù–û–°–¢–¨: –≤—ã—Å–æ–∫–∞—è
–û–ë–û–°–ù–û–í–ê–ù–ò–ï: –ö–∞—Ç–µ–≥–æ—Ä–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–æ—Å—Ç 5% –≤ –º–µ—Å—è—Ü –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –ø–µ—Ä–∏–æ–¥–∞. –ü—Ä–æ–≥–Ω–æ–∑ –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ —ç–∫—Å—Ç—Ä–∞–ø–æ–ª—è—Ü–∏–∏ —Ç—Ä–µ–Ω–¥–∞.
"""
        return prompt

    async def build_cashflow_forecast(
        self,
        df: pd.DataFrame,
        last_period: Any
    ) -> pd.DataFrame:
        """
        –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è —Å –∞–Ω–∞–ª–∏–∑–æ–º
        """
        forecasts = []
        explanations = []  # –ù–æ–≤–æ–µ: —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±—ä—è—Å–Ω–µ–Ω–∏—è
        confidence_levels = []  # –ù–æ–≤–æ–µ: —Å–æ—Ö—Ä–∞–Ω—è–µ–º —É—Ä–æ–≤–Ω–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏

        for index, row in df.iterrows():
            category = row['category']
            values = [v for k, v in row.items() if k != 'category']

            # –ù–æ–≤–æ–µ: –í—ã–ø–æ–ª–Ω—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
            analysis = analyze_historical_data(category, values)

            # –ù–æ–≤–æ–µ: –°–æ–∑–¥–∞–µ–º —É–ª—É—á—à–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç
            message = self._create_advanced_prompt(category, values, analysis)

            with trace("make_forecast"):
                result = await Runner.run(self.agent, message)

            # TODO: –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
            # –ü–æ–¥—Å–∫–∞–∑–∫–∞: –ò–∑–≤–ª–µ–∫–∏—Ç–µ –ü–†–û–ì–ù–û–ó, –£–í–ï–†–ï–ù–ù–û–°–¢–¨, –û–ë–û–°–ù–û–í–ê–ù–ò–ï

            # import re
            # forecast_match = re.search(r'–ü–†–û–ì–ù–û–ó:\s*(-?\d+\.?\d*)', result.final_output)
            # confidence_match = re.search(r'–£–í–ï–†–ï–ù–ù–û–°–¢–¨:\s*(\w+)', result.final_output)
            # explanation_match = re.search(r'–û–ë–û–°–ù–û–í–ê–ù–ò–ï:\s*(.+)', result.final_output)

            # forecast_value = float(forecast_match.group(1)) if forecast_match else values[-1]
            # confidence = confidence_match.group(1) if confidence_match else "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"
            # explanation = explanation_match.group(1).strip() if explanation_match else ""

            forecasts.append(forecast_value)
            confidence_levels.append(confidence)
            explanations.append(explanation)

        # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏
        df['ai_forecast'] = forecasts
        df['confidence'] = confidence_levels  # –ù–æ–≤–æ–µ
        df['explanation'] = explanations  # –ù–æ–≤–æ–µ

        return df
```

---

### –®–∞–≥ 3: –î–æ–±–∞–≤—å—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

–°–æ–∑–¥–∞–π—Ç–µ –º–µ—Ç–æ–¥ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç—Ä–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:

```python
async def build_scenario_forecasts(
    self,
    df: pd.DataFrame,
    last_period: Any
) -> pd.DataFrame:
    """
    –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç—Ä–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è: –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–π, –±–∞–∑–æ–≤—ã–π, –ø–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–Ω—ã–π

    Returns:
        DataFrame —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏:
        - ai_forecast_base (–±–∞–∑–æ–≤—ã–π)
        - ai_forecast_optimistic (–æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–π)
        - ai_forecast_pessimistic (–ø–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–Ω—ã–π)
    """
    # TODO: –†–µ–∞–ª–∏–∑—É–π—Ç–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

    # –ü–æ–¥—Å–∫–∞–∑–∫–∞ 1: –î–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–¥–µ–ª–∞–π—Ç–µ 3 –ø—Ä–æ–≥–Ω–æ–∑–∞
    # –ë–∞–∑–æ–≤—ã–π: –æ–±—ã—á–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑
    # –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–π: +15% –¥–ª—è –¥–æ—Ö–æ–¥–æ–≤, -15% –¥–ª—è —Ä–∞—Å—Ö–æ–¥–æ–≤
    # –ü–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–Ω—ã–π: -15% –¥–ª—è –¥–æ—Ö–æ–¥–æ–≤, +15% –¥–ª—è —Ä–∞—Å—Ö–æ–¥–æ–≤

    # –ü–æ–¥—Å–∫–∞–∑–∫–∞ 2: –ò–ª–∏ –ø–æ–ø—Ä–æ—Å–∏—Ç–µ AI —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å 3 —Å—Ü–µ–Ω–∞—Ä–∏—è –≤ –æ–¥–Ω–æ–º –ø—Ä–æ–º–ø—Ç–µ
    # prompt = """
    # –î–∞–π 3 –ø—Ä–æ–≥–Ω–æ–∑–∞:
    # –ë–ê–ó–û–í–´–ô: [–Ω–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ]
    # –û–ü–¢–ò–ú–ò–°–¢–ò–ß–ù–´–ô: [–ª—É—á—à–∏–π —Å–ª—É—á–∞–π, +15-20% –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ –¥–ª—è –¥–æ—Ö–æ–¥–æ–≤]
    # –ü–ï–°–°–ò–ú–ò–°–¢–ò–ß–ù–´–ô: [—Ö—É–¥—à–∏–π —Å–ª—É—á–∞–π, -15-20% –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ –¥–ª—è –¥–æ—Ö–æ–¥–æ–≤]
    # """

    pass  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –∫–æ–¥
```

---

### –®–∞–≥ 4: –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ –≤ UI

–û–±–Ω–æ–≤–∏—Ç–µ `app.py`, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:

```python
# –í —Ä–∞–∑–¥–µ–ª–µ –∫–Ω–æ–ø–∫–∏ "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø—Ä–æ–≥–Ω–æ–∑ AI"

if st.button("üîÆ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø—Ä–æ–≥–Ω–æ–∑ —Å AI", type="primary", use_container_width=True):
    try:
        with st.spinner("AI-–∞–≥–µ–Ω—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ —Å—Ç—Ä–æ–∏—Ç –ø—Ä–æ–≥–Ω–æ–∑..."):
            from ai_agents.forecast_agent import build_cashflow_forecast

            df_wide_for_forecast = pivot_to_wide_format(df_history)
            last_month = get_next_month_name(df_history, 'date')
            forecast_df = build_cashflow_forecast(df_wide_for_forecast, last_month)

            # –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥–Ω–æ–∑—ã
            updated_df = edited_df.copy()
            for idx, category in enumerate(forecast_df['category']):
                category_idx = updated_df[updated_df['category'] == category].index
                if len(category_idx) > 0:
                    updated_df.loc[category_idx[0], forecast_col] = forecast_df.loc[idx, 'ai_forecast']

            updated_df[total_col] = updated_df[forecast_col] + updated_df[adjustment_col]
            st.session_state['edited_df'] = updated_df

            # –ù–û–í–û–ï: –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            st.session_state['forecast_details'] = forecast_df[['category', 'confidence', 'explanation']]

            st.success(f"‚úÖ –ü—Ä–æ–≥–Ω–æ–∑ –ø–æ—Å—Ç—Ä–æ–µ–Ω! –û–±–Ω–æ–≤–ª–µ–Ω–æ {len(forecast_df)} –∫–∞—Ç–µ–≥–æ—Ä–∏–π")
            st.rerun()

    except Exception as e:
        st.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –ø—Ä–æ–≥–Ω–æ–∑–∞: {str(e)}")

# –ù–û–í–û–ï: –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏ –ø—Ä–æ–≥–Ω–æ–∑–∞
if 'forecast_details' in st.session_state:
    st.divider()
    st.subheader("üìä –î–µ—Ç–∞–ª–∏ AI-–ø—Ä–æ–≥–Ω–æ–∑–∞")

    details_df = st.session_state['forecast_details']

    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    st.dataframe(
        details_df,
        column_config={
            "category": st.column_config.TextColumn("–ö–∞—Ç–µ–≥–æ—Ä–∏—è", width="medium"),
            "confidence": st.column_config.TextColumn("–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å", width="small"),
            "explanation": st.column_config.TextColumn("–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ", width="large")
        },
        hide_index=True,
        use_container_width=True
    )
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

–í–∞—à —É–ª—É—á—à–µ–Ω–Ω—ã–π –∞–≥–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω:

1. ‚úÖ –í—ã—á–∏—Å–ª—è—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (—Ç—Ä–µ–Ω–¥, –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å, —Å—Ä–µ–¥–Ω–µ–µ, std)
2. ‚úÖ –û–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ç–∏–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–¥–æ—Ö–æ–¥/—Ä–∞—Å—Ö–æ–¥)
3. ‚úÖ –°–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
4. ‚úÖ –ü–∞—Ä—Å–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –æ—Ç AI
5. ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø—Ä–æ–≥–Ω–æ–∑ + —É—Ä–æ–≤–µ–Ω—å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ + –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
6. ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –≤ UI

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `test_advanced_forecast.py`:

```python
from core.io_historical import load_history_from_file
from ai_agents.forecast_agent import build_cashflow_forecast
from core.data_transform import pivot_to_wide_format, get_next_month_name

# –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
df = load_history_from_file('data/sample_cashflow.csv')

# –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —à–∏—Ä–æ–∫–∏–π —Ñ–æ—Ä–º–∞—Ç
df_wide = pivot_to_wide_format(df)

# –°—Ç—Ä–æ–∏–º –ø—Ä–æ–≥–Ω–æ–∑
last_month = get_next_month_name(df, 'date')
forecast = build_cashflow_forecast(df_wide, last_month)

print("=" * 80)
print("–£–õ–£–ß–®–ï–ù–ù–´–ô –ü–†–û–ì–ù–û–ó CASH FLOW")
print("=" * 80)

for idx, row in forecast.iterrows():
    print(f"\n–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {row['category']}")
    print(f"  –ü—Ä–æ–≥–Ω–æ–∑: {row['ai_forecast']:,.2f}")
    print(f"  –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {row.get('confidence', 'N/A')}")
    print(f"  –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: {row.get('explanation', 'N/A')}")

print("\n" + "=" * 80)
print(f"–ò—Ç–æ–≥–æ–≤—ã–π –ø—Ä–æ–≥–Ω–æ–∑: {forecast['ai_forecast'].sum():,.2f}")
print("=" * 80)
```

–ó–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
python test_advanced_forecast.py
```

---

## üí° –ü–æ–¥—Å–∫–∞–∑–∫–∏

### –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–∞

```python
# –õ–∏–Ω–µ–π–Ω–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–∞
import numpy as np
from scipy import stats

def calculate_trend_slope(values):
    x = np.arange(len(values))
    slope, intercept, r_value, p_value, std_err = stats.linregress(x, values)
    return slope
```

### –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞

```python
import re

def parse_ai_response(text):
    """–ò–∑–≤–ª–µ–∫–∞–µ—Ç –ø—Ä–æ–≥–Ω–æ–∑, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –∏ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ"""
    forecast = None
    confidence = "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"
    explanation = ""

    # –ò—â–µ–º –ü–†–û–ì–ù–û–ó
    forecast_match = re.search(r'–ü–†–û–ì–ù–û–ó:\s*(-?\d+\.?\d*)', text, re.IGNORECASE)
    if forecast_match:
        forecast = float(forecast_match.group(1))

    # –ò—â–µ–º –£–í–ï–†–ï–ù–ù–û–°–¢–¨
    confidence_match = re.search(r'–£–í–ï–†–ï–ù–ù–û–°–¢–¨:\s*(\w+)', text, re.IGNORECASE)
    if confidence_match:
        confidence = confidence_match.group(1)

    # –ò—â–µ–º –û–ë–û–°–ù–û–í–ê–ù–ò–ï
    explanation_match = re.search(r'–û–ë–û–°–ù–û–í–ê–ù–ò–ï:\s*(.+)', text, re.IGNORECASE | re.DOTALL)
    if explanation_match:
        explanation = explanation_match.group(1).strip()

    return forecast, confidence, explanation
```

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏

```python
def detect_seasonality(values):
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Å–µ–∑–æ–Ω–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
    """
    if len(values) < 12:
        return "–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö"

    # –ü—Ä–æ—Å—Ç–æ–π –ø–æ–¥—Ö–æ–¥: –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—é —Å –ø—Ä–æ—à–ª–æ–≥–æ–¥–Ω–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
    # –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º FFT –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç–∏

    from scipy.fft import fft
    frequencies = fft(values)
    # ... –∞–Ω–∞–ª–∏–∑ —á–∞—Å—Ç–æ—Ç ...

    return "—Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞" or "—Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏ –Ω–µ—Ç"
```

---

## üéì –ß—Ç–æ –≤—ã –∏–∑—É—á–∏—Ç–µ

1. ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤
2. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ-–∑–∞–≤–∏—Å–∏–º—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
3. ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç LLM
4. ‚úÖ –†–∞–±–æ—Ç—É —Å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é AI-–º–æ–¥–µ–ª–µ–π
5. ‚úÖ –û–±—ä—è—Å–Ω–∏–º—ã–π AI (Explainable AI)
6. ‚úÖ –°—Ü–µ–Ω–∞—Ä–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üî• –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 1. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–µ–Ω–¥–∞

```python
import plotly.graph_objects as go

def plot_forecast_with_trend(historical, forecast):
    fig = go.Figure()

    # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏e –¥–∞–Ω–Ω—ã–µ
    fig.add_trace(go.Scatter(
        y=historical,
        mode='lines+markers',
        name='–ò—Å—Ç–æ—Ä–∏—è'
    ))

    # –ü—Ä–æ–≥–Ω–æ–∑
    fig.add_trace(go.Scatter(
        y=[historical[-1], forecast],
        mode='lines+markers',
        name='–ü—Ä–æ–≥–Ω–æ–∑',
        line=dict(dash='dash')
    ))

    return fig

# –í app.py:
st.plotly_chart(plot_forecast_with_trend(values, forecast_value))
```

### 2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤

```python
# –î–æ–±–∞–≤—å—Ç–µ –≤ models.py:
class ForecastHistory(Base):
    __tablename__ = 'forecast_history'

    id = Column(Integer, primary_key=True)
    scenario_id = Column(Integer, ForeignKey('scenarios.id'))
    category = Column(String)
    forecast_value = Column(Float)
    confidence_level = Column(String)
    explanation = Column(Text)
    created_at = Column(DateTime, default=datetime.utcnow)
```

### 3. A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

```python
# –°—Ä–∞–≤–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–∑–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
models = ["gpt-4o-mini", "gpt-4o", "gpt-3.5-turbo"]

for model in models:
    forecast = build_forecast(df, model=model)
    # –°—Ä–∞–≤–Ω–∏—Ç–µ —Ç–æ—á–Ω–æ—Å—Ç—å, —Å–∫–æ—Ä–æ—Å—Ç—å, —Å—Ç–æ–∏–º–æ—Å—Ç—å
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- [Time Series Analysis with Python](https://otexts.com/fpp3/)
- [Explainable AI](https://christophm.github.io/interpretable-ml-book/)
- [Prompt Engineering Guide](https://www.promptingguide.ai/)
- [Pandas Time Series](https://pandas.pydata.org/docs/user_guide/timeseries.html)

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ó–∞–¥–∞–Ω–∏—è 3:
- –°—Ä–∞–≤–Ω–∏—Ç–µ —Ç–æ—á–Ω–æ—Å—Ç—å –ø—Ä–æ—Å—Ç–æ–≥–æ vs —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∞
- –î–æ–±–∞–≤—å—Ç–µ –º–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ (MAE, RMSE)
- –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ª—É—á—à–µ–≥–æ –º–µ—Ç–æ–¥–∞ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ –ó–∞–¥–∞–Ω–∏—é 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã)

---

**–£–¥–∞—á–∏ —Å —É–ª—É—á—à–µ–Ω–∏–µ–º –ø—Ä–æ–≥–Ω–æ–∑–æ–≤!** üìà‚ú®
